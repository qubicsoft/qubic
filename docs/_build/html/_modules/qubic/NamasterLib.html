<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>qubic.NamasterLib &mdash; Qubicsoft 5.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=ee801c84"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Qubicsoft
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Qubicsoft</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">qubic.NamasterLib</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for qubic.NamasterLib</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">healpy</span> <span class="k">as</span> <span class="nn">hp</span>
<span class="kn">import</span> <span class="nn">pymaster</span> <span class="k">as</span> <span class="nn">nmt</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Namaster&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="Namaster">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster">[docs]</a>
<span class="k">class</span> <span class="nc">Namaster</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight_mask</span><span class="p">,</span> <span class="n">lmin</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">delta_ell</span><span class="p">,</span> <span class="n">aposize</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">apotype</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weight_mask: ndarray</span>
<span class="sd">        lmin: int</span>
<span class="sd">            Minimal l for power spectrum.</span>
<span class="sd">        lmax: int</span>
<span class="sd">            Maximal l for power spectrum.</span>
<span class="sd">        delta_ell: int</span>

<span class="sd">        aposize: apodization scale in degrees.</span>
<span class="sd">            10.0 by default.</span>
<span class="sd">        apotype: apodization type.</span>
<span class="sd">            Three methods implemented: C1, C2 and Smooth.</span>
<span class="sd">            &#39;C1&#39; by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lmin</span><span class="p">)</span>
        <span class="n">lmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lmax</span><span class="p">)</span>
        <span class="n">delta_ell</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">delta_ell</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lmin</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input lmin is less than 1.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lmax</span> <span class="o">&lt;</span> <span class="n">lmin</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input lmax is less than lmin.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmin</span> <span class="o">=</span> <span class="n">lmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta_ell</span> <span class="o">=</span> <span class="n">delta_ell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ells</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bpws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binning</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aposize</span> <span class="o">=</span> <span class="n">aposize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apotype</span> <span class="o">=</span> <span class="n">apotype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsky</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># ## Mask</span>
        <span class="k">if</span> <span class="n">weight_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weight_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">weight_mask</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_apo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_apodized_mask</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_apo</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_apo</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_apo</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f0bis</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f2bis</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cw</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Namaster.get_binning">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_binning">[docs]</a>
    <span class="k">def</span> <span class="nf">get_binning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nside</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Binning informations.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nside: the nside of the maps</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The binned monopoles and the NmtBin object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">NmtBin</span><span class="p">(</span><span class="n">nside</span><span class="p">,</span>
                       <span class="n">bpws</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bpws</span><span class="p">,</span>
                       <span class="n">ells</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ells</span><span class="p">,</span>
                       <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span>
                       <span class="n">lmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="p">,</span>
                       <span class="n">is_Dell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ell_binned</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_effective_ells</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span> <span class="o">=</span> <span class="n">ell_binned</span>

        <span class="k">return</span> <span class="n">ell_binned</span><span class="p">,</span> <span class="n">b</span></div>


<div class="viewcode-block" id="Namaster.bin_spectra">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.bin_spectra">[docs]</a>
    <span class="k">def</span> <span class="nf">bin_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_cls</span><span class="p">,</span> <span class="n">nside</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bin a spectrum.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        input_cls: 1D array</span>
<span class="sd">            input Cls spectrum</span>
<span class="sd">        nside: the nside of the maps</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The binned power spectrum Dl = l(l+1)*Cl.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ell_binned</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_binning</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>
        <span class="n">input_cls_reshape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">input_cls</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">cls_binned</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">bin_cell</span><span class="p">(</span><span class="n">input_cls_reshape</span><span class="p">)</span>

        <span class="n">fact</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="n">ell_binned</span> <span class="o">*</span> <span class="p">(</span><span class="n">ell_binned</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fact</span> <span class="o">*</span> <span class="n">cls_binned</span></div>


<div class="viewcode-block" id="Namaster.get_apodized_mask">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_apodized_mask">[docs]</a>
    <span class="k">def</span> <span class="nf">get_apodized_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make an apodized mask. The pure-B formalism requires the mask to be</span>
<span class="sd">        differentiable along the edges. The &#39;C1&#39; and &#39;C2&#39; apodization types</span>
<span class="sd">        supported by mask_apodization achieve this.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">nside2resol</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">npix2nside</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight_mask</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">resol</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">aposize</span><span class="p">:</span>
            <span class="n">mask_apo</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">mask_apodization</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weight_mask</span><span class="p">,</span>
                                            <span class="n">aposize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aposize</span><span class="p">,</span>
                                            <span class="n">apotype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">apotype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_apo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_mask</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mask_apo</span></div>


<div class="viewcode-block" id="Namaster.get_fields">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_fields">[docs]</a>
    <span class="k">def</span> <span class="nf">get_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="n">mask_apo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">purify_e</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">purify_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">beam_correction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        map: array</span>
<span class="sd">            IQU maps, shape (3, #pixels)</span>
<span class="sd">        mask_apo: array, optionnal (if not given the one used at the object&#39;s instanciation is used)</span>
<span class="sd">            Apodized mask.</span>
<span class="sd">        purify_e: bool, optional</span>
<span class="sd">            False by default.</span>
<span class="sd">        purify_b: bool, optional</span>
<span class="sd">            True by default.</span>
<span class="sd">            Note that generally it&#39;s not a good idea to purify both,</span>
<span class="sd">            since you&#39;ll lose sensitivity on E</span>
<span class="sd">        beam_correction: bool, optional</span>
<span class="sd">            None by default.</span>
<span class="sd">            If True, a correction by the Qubic beam at 150GHz is applied.</span>
<span class="sd">            You can also give the beam FWHM you want to correct for.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        f0, f2: spin-0 and spin-2 Namaster fields.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># The maps may contain hp.UNSEEN - They must be replaced with zeros</span>
        <span class="n">undefpix</span> <span class="o">=</span> <span class="nb">map</span> <span class="o">==</span> <span class="n">hp</span><span class="o">.</span><span class="n">UNSEEN</span>
        <span class="nb">map</span><span class="p">[</span><span class="n">undefpix</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mp_t</span><span class="p">,</span> <span class="n">mp_q</span><span class="p">,</span> <span class="n">mp_u</span> <span class="o">=</span> <span class="nb">map</span>
        <span class="n">nside</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">npix2nside</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mp_t</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mask_apo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask_apo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_apo</span>

        <span class="k">if</span> <span class="n">beam_correction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">beam_correction</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># Default value for QUBIC at 150 GHz</span>
                <span class="n">beam</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">gauss_beam</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mf">0.39268176</span><span class="p">),</span>
                                     <span class="n">lmax</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">nside</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">beam</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">gauss_beam</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">beam_correction</span><span class="p">),</span>
                                     <span class="n">lmax</span><span class="o">=</span><span class="mi">3</span> <span class="o">*</span> <span class="n">nside</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beam</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">f0</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">NmtField</span><span class="p">(</span><span class="n">mask_apo</span><span class="p">,</span>
                          <span class="p">[</span><span class="n">mp_t</span><span class="p">],</span>
                          <span class="n">beam</span><span class="o">=</span><span class="n">beam</span><span class="p">)</span>

        <span class="n">f2</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">NmtField</span><span class="p">(</span><span class="n">mask_apo</span><span class="p">,</span>
                          <span class="p">[</span><span class="n">mp_q</span><span class="p">,</span> <span class="n">mp_u</span><span class="p">],</span>
                          <span class="n">purify_e</span><span class="o">=</span><span class="n">purify_e</span><span class="p">,</span>
                          <span class="n">purify_b</span><span class="o">=</span><span class="n">purify_b</span><span class="p">,</span>
                          <span class="n">beam</span><span class="o">=</span><span class="n">beam</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f0</span> <span class="o">=</span> <span class="n">f0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f2</span> <span class="o">=</span> <span class="n">f2</span>

        <span class="k">return</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f2</span></div>


<div class="viewcode-block" id="Namaster.compute_master">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.compute_master">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_master</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_a</span><span class="p">,</span> <span class="n">field_b</span><span class="p">,</span> <span class="n">workspace</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        field_a: NmtField</span>
<span class="sd">        field_b: NmtField</span>
<span class="sd">        workspace: NmtWorkspace</span>
<span class="sd">            Contains the coupling matrix</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            decoupled Cls.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cl_coupled</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">compute_coupled_cell</span><span class="p">(</span><span class="n">field_a</span><span class="p">,</span> <span class="n">field_b</span><span class="p">)</span>
        <span class="n">cl_decoupled</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="n">decouple_cell</span><span class="p">(</span><span class="n">cl_coupled</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cl_decoupled</span></div>


<div class="viewcode-block" id="Namaster.get_spectra">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_spectra">[docs]</a>
    <span class="k">def</span> <span class="nf">get_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="n">mask_apo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">map2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">purify_e</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">purify_b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">beam_correction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pixwin_correction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get spectra from IQU maps.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        map: array</span>
<span class="sd">            IQU maps, shape (3, #pixels)</span>
<span class="sd">        mask_apo: array, optional (if not given then the maks used at the object&#39;s instanciation is used)</span>
<span class="sd">            Apodized mask.</span>
<span class="sd">        map2: array</span>
<span class="sd">            IQU maps, shape (3, #pixels) for Cross-Spectra</span>
<span class="sd">        purify_e: bool, optional</span>
<span class="sd">            False by default.</span>
<span class="sd">        purify_b: bool, optional</span>
<span class="sd">            True by default.</span>
<span class="sd">            Note that generally it&#39;s not a good idea to purify both,</span>
<span class="sd">            since you&#39;ll lose sensitivity on E</span>
<span class="sd">        w: list with Namaster workspace [w00, w22, w02]</span>
<span class="sd">            If None the workspaces will be created.</span>
<span class="sd">        beam_correction: bool, optional</span>
<span class="sd">            None by default.</span>
<span class="sd">            If True, a correction by the Qubic beam at 150GHz is applied.</span>
<span class="sd">            You can also give the beam FWHM you want to correct for.</span>
<span class="sd">        pixwin_correction: bool, optional</span>
<span class="sd">            If True, a correction for the pixel integration function is applied.</span>
<span class="sd">        verbose: bool, optional</span>
<span class="sd">            True by default.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ell_binned</span>
<span class="sd">        spectra: TT, EE, BB, TE spectra, Dl = ell * (ell + 1) / 2 * PI * Cl</span>
<span class="sd">        w: List containing the NmtWorkspaces [w00, w22, w02]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nside</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">npix2nside</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_binning</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mask_apo</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask_apo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_apo</span>

        <span class="c1"># Get fields</span>
        <span class="n">f0</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">mask_apo</span><span class="o">=</span><span class="n">mask_apo</span><span class="p">,</span>
                                 <span class="n">purify_e</span><span class="o">=</span><span class="n">purify_e</span><span class="p">,</span>
                                 <span class="n">purify_b</span><span class="o">=</span><span class="n">purify_b</span><span class="p">,</span>
                                 <span class="n">beam_correction</span><span class="o">=</span><span class="n">beam_correction</span><span class="p">)</span>

        <span class="c1"># Cross-Spectra case</span>
        <span class="k">if</span> <span class="n">map2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f0bis</span><span class="p">,</span> <span class="n">f2bis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields</span><span class="p">(</span><span class="n">map2</span><span class="p">,</span> <span class="n">mask_apo</span><span class="o">=</span><span class="n">mask_apo</span><span class="p">,</span>
                                           <span class="n">purify_e</span><span class="o">=</span><span class="n">purify_e</span><span class="p">,</span>
                                           <span class="n">purify_b</span><span class="o">=</span><span class="n">purify_b</span><span class="p">,</span>
                                           <span class="n">beam_correction</span><span class="o">=</span><span class="n">beam_correction</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f0bis</span> <span class="o">=</span> <span class="n">f0</span>
            <span class="n">f2bis</span> <span class="o">=</span> <span class="n">f2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">f0</span> <span class="o">=</span> <span class="n">f0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f0bis</span> <span class="o">=</span> <span class="n">f0bis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f2</span> <span class="o">=</span> <span class="n">f2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f2bis</span> <span class="o">=</span> <span class="n">f2bis</span>

        <span class="c1"># Make workspaces</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w00</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">NmtWorkspace</span><span class="p">()</span>
            <span class="n">w00</span><span class="o">.</span><span class="n">compute_coupling_matrix</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">f0bis</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="n">w22</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">NmtWorkspace</span><span class="p">()</span>
            <span class="n">w22</span><span class="o">.</span><span class="n">compute_coupling_matrix</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">f2bis</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="n">w02</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">NmtWorkspace</span><span class="p">()</span>
            <span class="n">w02</span><span class="o">.</span><span class="n">compute_coupling_matrix</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">f2bis</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="n">w00</span><span class="p">,</span> <span class="n">w22</span><span class="p">,</span> <span class="n">w02</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w00</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">w22</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">w02</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Get Cls</span>
        <span class="n">c00</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_master</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">f0bis</span><span class="p">,</span> <span class="n">w00</span><span class="p">)</span>
        <span class="n">c22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_master</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">f2bis</span><span class="p">,</span> <span class="n">w22</span><span class="p">)</span>
        <span class="n">c02</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_master</span><span class="p">(</span><span class="n">f0</span><span class="p">,</span> <span class="n">f2bis</span><span class="p">,</span> <span class="n">w02</span><span class="p">)</span>

        <span class="c1"># Put the 4 spectra in one array</span>
        <span class="n">spectra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c00</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c22</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c22</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">c02</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Getting TT, EE, BB, TE spectra in that order.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pixwin_correction</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">pwb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pixwin_correction</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>
            <span class="n">spectra</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/=</span> <span class="p">(</span><span class="n">pwb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># TT</span>
            <span class="n">spectra</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="p">(</span><span class="n">pwb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># EE</span>
            <span class="n">spectra</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/=</span> <span class="p">(</span><span class="n">pwb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># BB</span>
            <span class="n">spectra</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">/=</span> <span class="p">(</span><span class="n">pwb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">pwb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># TE</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">,</span> <span class="n">spectra</span><span class="p">,</span> <span class="n">w</span></div>


<div class="viewcode-block" id="Namaster.get_pixwin_correction">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_pixwin_correction">[docs]</a>
    <span class="k">def</span> <span class="nf">get_pixwin_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nside</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the binned pixel window function multiplied by 2pi/(l(l+1))</span>
<span class="sd">        for temperature and polarization &quot;&quot;&quot;</span>
        <span class="n">pw</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">pixwin</span><span class="p">(</span><span class="n">nside</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="p">))</span>

        <span class="n">ell_binned</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_binning</span><span class="p">(</span><span class="n">nside</span><span class="p">)</span>
        <span class="n">pwb</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="n">ell_binned</span> <span class="o">*</span> <span class="p">(</span><span class="n">ell_binned</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">bin_cell</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pw</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">pwb</span></div>


    <span class="k">def</span> <span class="nf">_binning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>  <span class="c1"># Array of multipoles</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_ell</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ells</span><span class="p">)</span>  <span class="c1"># Array of weights</span>
        <span class="n">bpws</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ells</span><span class="p">)</span>  <span class="c1"># Array of bandpower indices</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># print(self.lmax - self.delta_ell)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_ell</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_ell</span><span class="p">):</span>
            <span class="n">bpws</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_ell</span> <span class="o">*</span> <span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_ell</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">ells</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">bpws</span>

<div class="viewcode-block" id="Namaster.knox_errors">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.knox_errors">[docs]</a>
    <span class="k">def</span> <span class="nf">knox_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clth</span><span class="p">):</span>
        <span class="n">dcl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsky</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delta_ell</span><span class="p">)</span> <span class="o">*</span> <span class="n">clth</span>
        <span class="k">return</span> <span class="n">dcl</span></div>


<div class="viewcode-block" id="Namaster.knox_covariance">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.knox_covariance">[docs]</a>
    <span class="k">def</span> <span class="nf">knox_covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clth</span><span class="p">):</span>
        <span class="n">dcl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knox_errors</span><span class="p">(</span><span class="n">clth</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">dcl</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="Namaster.get_covariance_coeff">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_covariance_coeff">[docs]</a>
    <span class="k">def</span> <span class="nf">get_covariance_coeff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cw</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">NmtCovarianceWorkspace</span><span class="p">()</span>
            <span class="n">cw</span><span class="o">.</span><span class="n">compute_coupling_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f0</span><span class="p">,</span> <span class="n">lmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lmax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cw</span> <span class="o">=</span> <span class="n">cw</span></div>


<div class="viewcode-block" id="Namaster.get_covariance_TT_TT">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_covariance_TT_TT">[docs]</a>
    <span class="k">def</span> <span class="nf">get_covariance_TT_TT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cl_tt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_covariance_coeff</span><span class="p">()</span>
        <span class="n">w00</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">covar_00_00</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">gaussian_covariance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cw</span><span class="p">,</span>
                                              <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Spins of the 4 fields</span>
                                              <span class="p">[</span><span class="n">cl_tt</span> <span class="o">*</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># TT</span>
                                              <span class="p">[</span><span class="n">cl_tt</span> <span class="o">*</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># TT</span>
                                              <span class="p">[</span><span class="n">cl_tt</span> <span class="o">*</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># TT</span>
                                              <span class="p">[</span><span class="n">cl_tt</span> <span class="o">*</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># TT</span>
                                              <span class="n">w00</span><span class="p">,</span> <span class="n">wb</span><span class="o">=</span><span class="n">w00</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span>
                                                                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">),</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">covar_TT_TT</span> <span class="o">=</span> <span class="n">covar_00_00</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">covar_TT_TT</span></div>


<div class="viewcode-block" id="Namaster.get_covariance_EE_EE">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_covariance_EE_EE">[docs]</a>
    <span class="k">def</span> <span class="nf">get_covariance_EE_EE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cl_ee</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_covariance_coeff</span><span class="p">()</span>
        <span class="n">w22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n_ell</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cl_ee</span><span class="p">)</span>
        <span class="n">cl_eb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">cl_bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">covar_22_22</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">gaussian_covariance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cw</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Spins of the 4 fields</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="n">w22</span><span class="p">,</span> <span class="n">wb</span><span class="o">=</span><span class="n">w22</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span>
                                                                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">),</span> <span class="mi">4</span><span class="p">])</span>

        <span class="n">covar_EE_EE</span> <span class="o">=</span> <span class="n">covar_22_22</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># covar_EE_EB = covar_22_22[:, 0, :, 1]</span>
        <span class="c1"># covar_EE_BE = covar_22_22[:, 0, :, 2]</span>
        <span class="c1"># covar_EE_BB = covar_22_22[:, 0, :, 3]</span>
        <span class="c1"># covar_EB_EE = covar_22_22[:, 1, :, 0]</span>
        <span class="c1"># covar_EB_EB = covar_22_22[:, 1, :, 1]</span>
        <span class="c1"># covar_EB_BE = covar_22_22[:, 1, :, 2]</span>
        <span class="c1"># covar_EB_BB = covar_22_22[:, 1, :, 3]</span>
        <span class="c1"># covar_BE_EE = covar_22_22[:, 2, :, 0]</span>
        <span class="c1"># covar_BE_EB = covar_22_22[:, 2, :, 1]</span>
        <span class="c1"># covar_BE_BE = covar_22_22[:, 2, :, 2]</span>
        <span class="c1"># covar_BE_BB = covar_22_22[:, 2, :, 3]</span>
        <span class="c1"># covar_BB_EE = covar_22_22[:, 3, :, 0]</span>
        <span class="c1"># covar_BB_EB = covar_22_22[:, 3, :, 1]</span>
        <span class="c1"># covar_BB_BE = covar_22_22[:, 3, :, 2]</span>
        <span class="c1"># covar_BB_BB = covar_22_22[:, 3, :, 3]</span>

        <span class="k">return</span> <span class="n">covar_EE_EE</span></div>


<div class="viewcode-block" id="Namaster.get_covariance_BB_BB">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_covariance_BB_BB">[docs]</a>
    <span class="k">def</span> <span class="nf">get_covariance_BB_BB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">):</span>
        <span class="n">w22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n_ell</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cl_bb</span><span class="p">)</span>
        <span class="n">cl_eb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">cl_ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">covar_22_22</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">gaussian_covariance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cw</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Spins of the 4 fields</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="n">w22</span><span class="p">,</span> <span class="n">wb</span><span class="o">=</span><span class="n">w22</span><span class="p">)</span>

        <span class="n">covar_22_22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">covar_22_22</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">),</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># covar_EE_EE = covar_22_22[:, 0, :, 0]</span>
        <span class="c1"># covar_EE_EB = covar_22_22[:, 0, :, 1]</span>
        <span class="c1"># covar_EE_BE = covar_22_22[:, 0, :, 2]</span>
        <span class="c1"># covar_EE_BB = covar_22_22[:, 0, :, 3]</span>
        <span class="c1"># covar_EB_EE = covar_22_22[:, 1, :, 0]</span>
        <span class="c1"># covar_EB_EB = covar_22_22[:, 1, :, 1]</span>
        <span class="c1"># covar_EB_BE = covar_22_22[:, 1, :, 2]</span>
        <span class="c1"># covar_EB_BB = covar_22_22[:, 1, :, 3]</span>
        <span class="c1"># covar_BE_EE = covar_22_22[:, 2, :, 0]</span>
        <span class="c1"># covar_BE_EB = covar_22_22[:, 2, :, 1]</span>
        <span class="c1"># covar_BE_BE = covar_22_22[:, 2, :, 2]</span>
        <span class="c1"># covar_BE_BB = covar_22_22[:, 2, :, 3]</span>
        <span class="c1"># covar_BB_EE = covar_22_22[:, 3, :, 0]</span>
        <span class="c1"># covar_BB_EB = covar_22_22[:, 3, :, 1]</span>
        <span class="c1"># covar_BB_BE = covar_22_22[:, 3, :, 2]</span>
        <span class="n">covar_BB_BB</span> <span class="o">=</span> <span class="n">covar_22_22</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">covar_BB_BB</span></div>


<div class="viewcode-block" id="Namaster.get_covariance_TE_TE">
<a class="viewcode-back" href="../../qubic.html#qubic.NamasterLib.Namaster.get_covariance_TE_TE">[docs]</a>
    <span class="k">def</span> <span class="nf">get_covariance_TE_TE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cl_te</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_covariance_coeff</span><span class="p">()</span>
        <span class="n">w02</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">n_ell</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cl_te</span><span class="p">)</span>
        <span class="n">cl_tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">cl_bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">cl_ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">cl_eb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">cl_tb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_ell</span><span class="p">)</span>
        <span class="n">covar_02_02</span> <span class="o">=</span> <span class="n">nmt</span><span class="o">.</span><span class="n">gaussian_covariance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cw</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Spins of the 4 fields</span>
                                              <span class="p">[</span><span class="n">cl_tt</span><span class="p">],</span>  <span class="c1"># TT</span>
                                              <span class="p">[</span><span class="n">cl_te</span><span class="p">,</span> <span class="n">cl_tb</span><span class="p">],</span>  <span class="c1"># TE, TB</span>
                                              <span class="p">[</span><span class="n">cl_te</span><span class="p">,</span> <span class="n">cl_tb</span><span class="p">],</span>  <span class="c1"># ET, BT</span>
                                              <span class="p">[</span><span class="n">cl_ee</span><span class="p">,</span> <span class="n">cl_eb</span><span class="p">,</span>
                                               <span class="n">cl_eb</span><span class="p">,</span> <span class="n">cl_bb</span><span class="p">],</span>  <span class="c1"># EE, EB, BE, BB</span>
                                              <span class="n">w02</span><span class="p">,</span> <span class="n">wb</span><span class="o">=</span><span class="n">w02</span><span class="p">)</span>
        <span class="n">covar_02_02</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">covar_02_02</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ell_binned</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">covar_TE_TE</span> <span class="o">=</span> <span class="n">covar_02_02</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># covar_TE_TB = covar_02_02[:, 0, :, 1]</span>
        <span class="c1"># covar_TB_TE = covar_02_02[:, 1, :, 0]</span>
        <span class="c1"># covar_TB_TB = covar_02_02[:, 1, :, 1]</span>

        <span class="k">return</span> <span class="n">covar_TE_TE</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, QUBIC Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>