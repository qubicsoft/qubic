<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>lib.Fitting.QanalysisMC module &#8212; qubicsoft  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-lib.Fitting.QanalysisMC">
<span id="lib-fitting-qanalysismc-module"></span><h1>lib.Fitting.QanalysisMC module<a class="headerlink" href="#module-lib.Fitting.QanalysisMC" title="Link to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.Cp2Cp_prime">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">Cp2Cp_prime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Cp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.Cp2Cp_prime" title="Link to this definition">¶</a></dt>
<dd><p>Average the covariance matrices over pixels. A normalization by the 00 element is done
before averaging.
:type Cp: 
:param Cp: The covariance matrices for each pixel.</p>
<blockquote>
<div><p>Shape (#bands, #bands, #stokes, #pixels)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>verbose</strong> (<em>bool</em>)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Cp_prime</strong> – The covariance matrices for each pixel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (#bands, #bands, #Stokes, #pixels)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.Cp2Cp_prime_viaCorr">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">Cp2Cp_prime_viaCorr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Cp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.Cp2Cp_prime_viaCorr" title="Link to this definition">¶</a></dt>
<dd><p>Average the covariance matrices over pixels. A normalization is done
on pixels before the average.
:type Cp: 
:param Cp: The covariance matrices for each pixel.</p>
<blockquote>
<div><p>Shape: (#bands, #bands, #Stokes, #pixels)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>verbose</strong> (<em>bool</em>)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Cp_prime</strong> – The covariance matrices for each pixel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (#bands, #bands, #Stokes, #pixels)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.average_pix_sig2">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">average_pix_sig2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sig2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ang</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ang_threshold</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.average_pix_sig2" title="Link to this definition">¶</a></dt>
<dd><p>Average the variances over pixels in a given angle.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.covariance_IQU_subbands">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">covariance_IQU_subbands</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">allmaps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stokesjoint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.covariance_IQU_subbands" title="Link to this definition">¶</a></dt>
<dd><p>Returns the mean maps, averaged over pixels and realisations and the
covariance matrices of the maps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>allmaps</strong> (<em>list</em>) – List of arrays of shape (nreals, nsub, npix, 3)
List of maps for each number of sub-bands.</p></li>
<li><p><strong>stokesjoint</strong> (<em>if True return Stokes parameter together</em>) – I0,I1,…, Q0,Q1,…, U0,U1, … . Otherwise will return
I0,Q0,U0,  I1,Q1,U1, …
Default: False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>allmean</strong> (<em>list of arrays of shape 3*nsub</em>) – mean for I, Q, U for each subband</p></li>
<li><p><strong>allcov</strong> (<em>list of arrays of shape (3*nsub, 3*nsub)</em>) – covariance matrices between stokes parameters and sub frequency bands</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.distance_square">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">distance_square</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.distance_square" title="Link to this definition">¶</a></dt>
<dd><p>Return a distance associated to a matrix (n*n).
Sum of the square elements normalized by n**2.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.distance_sup">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">distance_sup</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.distance_sup" title="Link to this definition">¶</a></dt>
<dd><p>Return a distance associated to a matrix (n*n).
Normalized by n.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_Cp">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_Cp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">patch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doplot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_Cp" title="Link to this definition">¶</a></dt>
<dd><p>Returns covariance matrices between subbands for each Stokes parameter
and each pixel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>patch</strong> (<em>ndarray</em>) – Shape (#reals, #bands, #pixels, 3)</p></li>
<li><p><strong>verbose</strong> (<em>Bool</em>) – If True makes a lot of prints.</p></li>
<li><p><strong>doplot</strong> (<em>Bool</em>) – If True, plot the mean cov and corr matrices over pixels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Cp</strong> – The covariance matrices.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array of shape (#bands, #bands, 3, #pixels)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_corrections">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_corrections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nf_sub</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nf_recon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">band</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">150</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relative_bandwidth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_corrections" title="Link to this definition">¶</a></dt>
<dd><p>The reconstructed subbands have different widths.
Here, we compute the corrections you can applied to
the variances and covariances to take this into account.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nf_sub</strong> (<em>int</em>) – Number of input subbands</p></li>
<li><p><strong>nf_recon</strong> (<em>int</em>) – Number of reconstructed subbands</p></li>
<li><p><strong>band</strong> (<em>int</em>) – QUBIC frequency band, in GHz. 150 by default
Typical values: 150, 220.</p></li>
<li><p><strong>relative_bandwidth</strong> (<em>float</em>) – Ratio of the difference between the edges of the
frequency band over the average frequency of the band
Typical value: 0.25</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>corrections</strong> (<em>list</em>) – Correction coefficients for each subband.</p></li>
<li><p><strong>correction_mat</strong> (<em>array of shape (3xnf_recon, 3xnf_recon)</em>) – Matrix containing the corrections.
It can be multiplied term by term to a covariance matrix.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_covcorr1pix">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_covcorr1pix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">maps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ipix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stokesjoint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_covcorr1pix" title="Link to this definition">¶</a></dt>
<dd><p>This function return the covariance matrix for one pixel given a list of maps.
Each of the Nreal maps has the shape (nfrec, npix, 3) (see save_simu_fits() ).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>maps</strong> (<em>array</em>) – Input maps with shape (nrealizations, nfrecons, npix, 3)</p></li>
<li><p><strong>ipix</strong> (<em>int</em>) – pixel where the covariance will be computed</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – If True, print information. False by default.</p></li>
<li><p><strong>stokesjoint</strong> (<em>bool</em>) – If True return Stokes parameter together
I0,I1,…, Q0,Q1,…, U0, U1, … . Otherwise will return
I0,Q0,U0,  I1,Q1,U1, …
Default: False</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>cov1pix</strong> (<em>np.array</em>) – covariance matrix for a given pixel (ipix) with shape 3*nfrec x 3*nfrec</p></li>
<li><p><strong>corr1pix</strong> (<em>np.array</em>) – correlation matrix for a given pixel (ipix) with shape 3*nfrec x 3*nfrec</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_covcorr_between_pix">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_covcorr_between_pix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">maps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_covcorr_between_pix" title="Link to this definition">¶</a></dt>
<dd><p>Compute the pixel covariance matrix and correlation matrix
minus the identity over many realisations. You will obtain nsub x 3
matrices of shape (npix x npix).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>maps</strong> (<em>array</em>) – Input maps with shape (nreal, nsub, npix, 3)</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – If True, print information. False by default.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>cov_pix</strong> (<em>array of shape (nsub, nstokes, npix, npix)</em>) – The covariance matrices for each subband and I, Q, U.</p></li>
<li><p><strong>corr_pix</strong> (<em>array of shape (nsub, nstokes, npix, npix)</em>) – The correlation matrices minus the identity (0. on the diagonal).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_covcorr_patch">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_covcorr_patch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">patch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stokesjoint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doplot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_covcorr_patch" title="Link to this definition">¶</a></dt>
<dd><p>This function computes the covariance matrix and the correlation matrix for a given patch in the sky.
It uses get_covcorr1pix() to compute the covariance and correlation matrix for each pixel (ipix).</p>
<p>Asumptions: patch.shape = (nreals, nbands, npix_patch, nstokes) –&gt; to be able to use get_covcorr1pix</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_mean_cov">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_mean_cov</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invcov</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_mean_cov" title="Link to this definition">¶</a></dt>
<dd><p>This function does the same as: get_weighted_correlation_average</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_residuals">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_residuals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fits_noise</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fits_noiseless</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">residuals_way</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_residuals" title="Link to this definition">¶</a></dt>
<dd><p>Compute residuals in a given way.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fits_noise</strong> (<em>list</em>) – List containing the reconstructed noisy maps (fits files)</p></li>
<li><p><strong>fits_noiseless</strong> (<em>str</em>) – Fits file containing the noiseless reconstruction</p></li>
<li><p><strong>residuals_way</strong> (<em>str</em>) – Way to compute residuals. 3 keywords : noiseless, conv or mean_recon</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>residuals : array of shape (#reals, #bands, #pixels, 3)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_rms_covar">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_rms_covar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nsubvals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seenmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allmapsout</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_rms_covar" title="Link to this definition">¶</a></dt>
<dd><p>Test done by Matthieu Tristram :
Calculate the variance map in each case accounting for the band-band covariance matrix for each pixel from the MC.
This is pretty noisy so it may be interesting to get the average matrix.
We calculate all the matrices for each pixel and normalize them to average 1
and then calculate the average matrix over the pixels.</p>
<p>variance_map : array of shape (len(nsubvals), 3, npixok)</p>
<dl class="simple">
<dt>allmeanmat<span class="classifier">list of arrays (nsub, nsub, 3)</span></dt><dd><p>Mean over pixels of the cov matrices freq-freq</p>
</dd>
<dt>allstdmat<span class="classifier">list of arrays (nsub, nsub, 3)</span></dt><dd><p>Std over pixels of the cov matrices freq-freq</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_rms_covarmean">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_rms_covarmean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nsubvals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seenmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allmapsout</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allmeanmat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_rms_covarmean" title="Link to this definition">¶</a></dt>
<dd><p>RMS map and mean map over the realisations using the pixel
averaged freq-freq covariance matrix computed with get_rms_covar
meanmap_cov : array of shape (len(nsubvals), 3, npixok)</p>
<p>rmsmap_cov : array of shape (len(nsubvals), 3, npixok)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.get_weighted_correlation_average">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">get_weighted_correlation_average</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cov</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.get_weighted_correlation_average" title="Link to this definition">¶</a></dt>
<dd><p>Compute a weighted average taking into account the correlations between the variables.
The mean obtained is the one that has the minimal variance possible.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>1D array</em>) – Values you want to average.</p></li>
<li><p><strong>cov</strong> (<em>2D array</em>) – Covariance matrix associated to the values in x.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>The weighted mean and the variance on that mean.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.make_weighted_av">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">make_weighted_av</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">patch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.make_weighted_av" title="Link to this definition">¶</a></dt>
<dd><p>Average the maps over subbands using the covariance matrix between subbands.
:type patch: 
:param patch: Shape (#reals, #bands, #pixels, #nstks)
:type patch: array
:type Cp: 
:param Cp: The covariance matrices.</p>
<blockquote>
<div><p>Shape (#bands, #bands, #nstks, #pixels)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>verbose</strong> (<em>bool</em>)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>weighted_av</strong> (<em>map averaged over bands</em>)</p></li>
<li><p><strong>sig2</strong> (<em>variances over realisations on the map</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.plot_hist">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">plot_hist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mat_npix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bins</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title_prefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ymax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'b'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.plot_hist" title="Link to this definition">¶</a></dt>
<dd><p>Plots the histograms of each element of the matrix.
Each histogram represents the distribution of a given
term over the pixels..</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mat_npix</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>3 x nfreq</em><em>, </em><em>3 x nfreq</em><em>, </em><em>npix</em><em>)</em>) – Cov or corr matrix for each pixel.</p></li>
<li><p><strong>bins</strong> (<em>int</em>) – Numbers of bins for the histogram</p></li>
<li><p><strong>title_prefix</strong> (<em>str</em>) – Prefix for the title of the plot.</p></li>
<li><p><strong>ymax</strong> (<em>float</em>) – Limit max on the y axis (between 0 and 1)</p></li>
<li><p><strong>color</strong> (<em>str</em>) – Color of the histogram</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.rms_method">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">rms_method</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">residuals_way</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zones</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">simulation_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.rms_method" title="Link to this definition">¶</a></dt>
<dd><p>Get the std of the residuals from one simulation.
STD are computed over realisations and pixels for I, Q, U separately.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> (<em>str</em>) – Simulation file.</p></li>
<li><p><strong>residuals_way</strong> (<em>str</em>) – Way to compute residuals. 3 keywords : noiseless, conv or mean_recon</p></li>
<li><p><strong>zones</strong> (<em>int</em>) – Number of zones to divide the patch.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>rms_I, rms_Q, rms_U</strong> (<em>dictionarys containing RMS for IQU</em>)</p></li>
<li><p><strong>setpar</strong> (<em>a dict with some parameters of the simu.</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lib.Fitting.QanalysisMC.std_profile">
<span class="sig-prename descclassname"><span class="pre">lib.Fitting.QanalysisMC.</span></span><span class="sig-name descname"><span class="pre">std_profile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">many_patch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbins</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nside</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seenmap</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lib.Fitting.QanalysisMC.std_profile" title="Link to this definition">¶</a></dt>
<dd><p>Get the std profile of a patch over pixels and realisations
from the center to the border.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>many_patch</strong> (<em>array</em><em> of </em><em>shape</em><em> (</em><em>nreal</em><em>, </em><em>nsub</em><em>, </em><em>npixok</em><em>, </em><em>3</em><em>)</em>) – Many realisations of one patch.</p></li>
<li><p><strong>nbins</strong> (<em>int</em>) – Number of bins.</p></li>
<li><p><strong>nside</strong> (<em>int</em>) – NSIDE in the patch.</p></li>
<li><p><strong>center</strong> (<em>array</em>) – Coordinates of the center of the patch in degree (lon, lat)</p></li>
<li><p><strong>seenmap</strong> (<em>array</em>) – Array of booleans of shape #pixels,
True inside the patch and False outside.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>bin_centers</strong> (<em>array with angles associated to each bin.</em>)</p></li>
<li><p><strong>ang</strong> (<em>array with angles associated to each pixel</em>)</p></li>
<li><p><strong>std_bin</strong> (<em>array of shape (nbins, nsub, 3)</em>) – Std value in each bin, for each subband and IQU.</p></li>
<li><p><strong>std_profile</strong> (<em>array of shape (npixok, nsub, 3)</em>) – Quadratic interpolation of the std_bin.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">qubicsoft</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, QUBIC Collaboration.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/lib.Fitting.QanalysisMC.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>